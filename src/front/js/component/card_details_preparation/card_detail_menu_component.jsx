import React, { useState, useEffect } from "react";
import { getChatGPTResponse } from "../../gpt/api";

export const Card_Detail_Component = ({ comida, dia, tipo_comida, ingredientes, calorias }) => {
    const [preparacion, setPreparacion] = useState([]);

    useEffect(() => {
        const messages = [
            {
                role: "system",
                content: "Eres un asistente de cocina que genera instrucciones de recetas.",
            },
            {
                role: "user",
                content: `Genera los pasos para preparar un plato llamado "${comida}" utilizando los siguientes ingredientes: ${ingredientes}. Devuelve los pasos numerados como una lista.`,
            },
        ];

        const fetchData = async () => {
            try {
                const response = await getChatGPTResponse(messages);
                const steps = response.content.split("\n").filter(step => step.trim() !== ""); // Divide por líneas y elimina vacías
                setPreparacion(steps);
            } catch (error) {
                console.error("Error al obtener los pasos de preparación:", error);
            }
        };

        fetchData();
    }, [comida, ingredientes]);

    return (
        <div className="d-flex flex-column gap-4">
            <div className="d-flex gap-2">
                <h5 className="modal-title" id="dataModalLabel"> {comida}</h5>
            </div>
            <div className="d-flex justify-content-between gap-2">
                <div className="d-flex flex-column">
                    <div className="d-flex gap-2">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.298 7.56606H2.70197C2.40658 7.56639 2.11509 7.63348 1.84928 7.76232C1.58347 7.89115 1.35022 8.0784 1.16697 8.31006C0.984469 8.54108 0.856944 8.8106 0.794052 9.09821C0.73116 9.38581 0.734549 9.68396 0.803965 9.97006L2.36897 16.3781C2.59556 17.2037 3.08752 17.9318 3.76897 18.4501C4.45097 18.9691 5.28597 19.2501 6.14497 19.2501H13.853C14.712 19.2501 15.547 18.9691 16.229 18.4501C16.9104 17.9318 17.4024 17.2037 17.629 16.3781L19.194 9.97106C19.2993 9.53912 19.2531 9.08409 19.063 8.68215C18.873 8.28021 18.5506 7.95575 18.15 7.76306C17.8834 7.63506 17.5917 7.56778 17.296 7.56606M6.08697 11.4601V15.3551M9.99996 11.4601V15.3551M13.913 11.4601V15.3551M16.848 7.56606C16.8476 6.67011 16.6702 5.78305 16.326 4.95588C15.9817 4.1287 15.4774 3.37771 14.842 2.74606C13.5554 1.46656 11.8144 0.748864 9.99996 0.750063C8.18551 0.748864 6.44448 1.46656 5.15797 2.74606C4.52273 3.37779 4.01858 4.12882 3.6745 4.95599C3.33042 5.78317 3.15318 6.67018 3.15297 7.56606" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <h4>Ingredients</h4>
                    </div>
                    <p>{ingredientes}</p>
                </div>
                <div className="d-flex flex-column">
                    <svg width="56" height="24" viewBox="0 0 56 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0.750061C12 2.1485 12.2578 3.43756 12.7734 4.61725C13.2891 5.79694 14.0312 6.88287 15 7.87506C15.9688 8.86725 16.7109 9.95319 17.2266 11.1329C17.7422 12.3126 18 13.6016 18 15.0001C18 15.8282 17.8945 16.6251 17.6836 17.3907C17.4727 18.1563 17.168 18.8712 16.7695 19.5352C16.3711 20.1993 15.9023 20.8087 15.3633 21.3633C14.8242 21.918 14.2188 22.3868 13.5469 22.7696C12.875 23.1524 12.1562 23.4532 11.3906 23.6719C10.625 23.8907 9.82812 24.0001 9 24.0001C8.17188 24.0001 7.375 23.8946 6.60938 23.6837C5.84375 23.4727 5.12891 23.168 4.46484 22.7696C3.80078 22.3712 3.19141 21.9024 2.63672 21.3633C2.08203 20.8243 1.61328 20.2188 1.23047 19.5469C0.847656 18.8751 0.546875 18.1563 0.328125 17.3907C0.109375 16.6251 0 15.8282 0 15.0001C0 14.3438 0.0703125 13.6993 0.210938 13.0665C0.351562 12.4337 0.554688 11.8282 0.820312 11.2501C1.08594 10.6719 1.41406 10.1212 1.80469 9.59772C2.19531 9.07428 2.63672 8.60162 3.12891 8.17975C3.18359 8.47662 3.25781 8.78131 3.35156 9.09381C3.44531 9.40631 3.55469 9.71881 3.67969 10.0313C3.80469 10.3438 3.95312 10.6407 4.125 10.9219C4.29688 11.2032 4.47656 11.4649 4.66406 11.7071C4.82031 11.9024 5.02344 12.0001 5.27344 12.0001C5.48438 12.0001 5.66016 11.9258 5.80078 11.7774C5.94141 11.629 6.01562 11.4493 6.02344 11.2383C6.02344 11.1524 6.01172 11.0743 5.98828 11.004C5.96484 10.9337 5.92578 10.8633 5.87109 10.793C5.65234 10.4727 5.46094 10.1563 5.29688 9.84381C5.13281 9.53131 4.98828 9.211 4.86328 8.88287C4.73828 8.55475 4.64844 8.2149 4.59375 7.86334C4.53906 7.51178 4.50781 7.14069 4.5 6.75006C4.5 5.82037 4.67578 4.94537 5.02734 4.12506C5.37891 3.30475 5.86328 2.5899 6.48047 1.98053C7.09766 1.37115 7.8125 0.890686 8.625 0.539124C9.4375 0.187561 10.3125 0.00787354 11.25 6.10352e-05H12V0.750061ZM9 22.5001C10.0391 22.5001 11.0117 22.3047 11.918 21.9141C12.8242 21.5235 13.6211 20.9883 14.3086 20.3087C14.9961 19.629 15.5312 18.836 15.9141 17.9297C16.2969 17.0235 16.4922 16.0469 16.5 15.0001C16.5 13.8204 16.2812 12.7227 15.8438 11.7071C15.4062 10.6915 14.7734 9.76959 13.9453 8.94147C12.9297 7.91803 12.1328 6.78912 11.5547 5.55475C10.9766 4.32037 10.6328 2.98444 10.5234 1.54694C9.875 1.63287 9.27734 1.82819 8.73047 2.13287C8.18359 2.43756 7.70312 2.82428 7.28906 3.29303C6.875 3.76178 6.55859 4.28912 6.33984 4.87506C6.12109 5.461 6.00781 6.086 6 6.75006C6 7.35944 6.08984 7.91022 6.26953 8.4024C6.44922 8.89459 6.71484 9.38678 7.06641 9.87897C7.21484 10.0821 7.32812 10.293 7.40625 10.5118C7.48438 10.7305 7.52734 10.9727 7.53516 11.2383C7.53516 11.5508 7.47656 11.8438 7.35938 12.1172C7.24219 12.3907 7.07812 12.629 6.86719 12.8321C6.65625 13.0352 6.41797 13.1993 6.15234 13.3243C5.88672 13.4493 5.59375 13.5079 5.27344 13.5001C4.91406 13.5001 4.59766 13.4337 4.32422 13.3008C4.05078 13.168 3.80859 12.9883 3.59766 12.7618C3.38672 12.5352 3.19922 12.2813 3.03516 12.0001C2.87109 11.7188 2.71484 11.4376 2.56641 11.1563C2.20703 11.7266 1.94141 12.3399 1.76953 12.9962C1.59766 13.6524 1.50781 14.3204 1.5 15.0001C1.5 16.0391 1.69531 17.0118 2.08594 17.918C2.47656 18.8243 3.01172 19.6212 3.69141 20.3087C4.37109 20.9962 5.16406 21.5313 6.07031 21.9141C6.97656 22.2969 7.95312 22.4922 9 22.5001Z" fill="black" />
                        <path d="M29.2969 5.49225V17.5001H27.2344V5.49225H29.2969ZM34.5938 9.04694L30.9141 13.1797L28.9219 15.2032L28.2656 13.6016L29.8047 11.6641L32.1016 9.04694H34.5938ZM32.4844 17.5001L29.8672 13.5626L31.2422 12.2266L34.875 17.5001H32.4844ZM39 16.0313C39.2917 16.0313 39.5521 15.974 39.7812 15.8594C40.0104 15.7449 40.1927 15.5834 40.3281 15.3751C40.4688 15.1667 40.5443 14.9245 40.5547 14.6485H42.5C42.4896 15.2214 42.3281 15.7344 42.0156 16.1876C41.7031 16.6407 41.2865 17.0001 40.7656 17.2657C40.25 17.5261 39.6719 17.6563 39.0312 17.6563C38.3802 17.6563 37.8125 17.5469 37.3281 17.3282C36.8438 17.1094 36.4401 16.8047 36.1172 16.4141C35.7995 16.0235 35.5599 15.5704 35.3984 15.0547C35.2422 14.5391 35.1641 13.987 35.1641 13.3985V13.1485C35.1641 12.56 35.2422 12.0079 35.3984 11.4922C35.5599 10.9766 35.7995 10.5235 36.1172 10.1329C36.4401 9.74225 36.8438 9.43756 37.3281 9.21881C37.8125 9.00006 38.3776 8.89069 39.0234 8.89069C39.7057 8.89069 40.3047 9.0235 40.8203 9.28912C41.3411 9.55475 41.7474 9.92975 42.0391 10.4141C42.3359 10.8985 42.4896 11.4688 42.5 12.1251H40.5547C40.5443 11.823 40.4766 11.5521 40.3516 11.3126C40.2266 11.073 40.0495 10.8803 39.8203 10.7344C39.5911 10.5886 39.3125 10.5157 38.9844 10.5157C38.6354 10.5157 38.3438 10.5886 38.1094 10.7344C37.8802 10.8803 37.7005 11.0808 37.5703 11.336C37.4453 11.586 37.3568 11.8672 37.3047 12.1797C37.2578 12.487 37.2344 12.81 37.2344 13.1485V13.3985C37.2344 13.7422 37.2578 14.0704 37.3047 14.3829C37.3568 14.6954 37.4453 14.9766 37.5703 15.2266C37.7005 15.4714 37.8802 15.6667 38.1094 15.8126C38.3438 15.9584 38.6406 16.0313 39 16.0313ZM48.5312 15.7032V11.8047C48.5312 11.5183 48.4818 11.2709 48.3828 11.0626C48.2839 10.8542 48.1328 10.6928 47.9297 10.5782C47.7266 10.4636 47.4688 10.4063 47.1562 10.4063C46.8802 10.4063 46.638 10.4532 46.4297 10.5469C46.2266 10.6407 46.0703 10.7735 45.9609 10.9454C45.8516 11.112 45.7969 11.3047 45.7969 11.5235H43.7266C43.7266 11.1745 43.8099 10.8438 43.9766 10.5313C44.1432 10.2136 44.3802 9.93235 44.6875 9.68756C45 9.43756 45.3724 9.24225 45.8047 9.10162C46.2422 8.961 46.7318 8.89069 47.2734 8.89069C47.9141 8.89069 48.4844 9.00006 48.9844 9.21881C49.4896 9.43235 49.8854 9.75527 50.1719 10.1876C50.4635 10.6199 50.6094 11.1641 50.6094 11.8204V15.5079C50.6094 15.9297 50.6354 16.2917 50.6875 16.5938C50.7448 16.8907 50.8281 17.1485 50.9375 17.3672V17.5001H48.8359C48.737 17.2865 48.6615 17.0157 48.6094 16.6876C48.5573 16.3542 48.5312 16.0261 48.5312 15.7032ZM48.8203 12.3516L48.8359 13.5782H47.5312C47.2083 13.5782 46.9245 13.612 46.6797 13.6797C46.4349 13.7422 46.2344 13.836 46.0781 13.961C45.9219 14.0808 45.8047 14.2266 45.7266 14.3985C45.6484 14.5652 45.6094 14.7553 45.6094 14.9688C45.6094 15.1771 45.6562 15.3646 45.75 15.5313C45.849 15.698 45.9896 15.8308 46.1719 15.9297C46.3594 16.0235 46.5781 16.0704 46.8281 16.0704C47.1927 16.0704 47.5104 15.9975 47.7812 15.8516C48.0521 15.7006 48.263 15.5183 48.4141 15.3047C48.5651 15.0912 48.6458 14.8881 48.6562 14.6954L49.25 15.586C49.1771 15.7995 49.0677 16.0261 48.9219 16.2657C48.776 16.5053 48.5885 16.7292 48.3594 16.9376C48.1302 17.1459 47.8542 17.3178 47.5312 17.4532C47.2083 17.5886 46.8333 17.6563 46.4062 17.6563C45.8594 17.6563 45.3698 17.5469 44.9375 17.3282C44.5052 17.1094 44.1641 16.81 43.9141 16.4297C43.6641 16.0495 43.5391 15.6172 43.5391 15.1329C43.5391 14.685 43.6224 14.2891 43.7891 13.9454C43.9557 13.6016 44.2031 13.3126 44.5312 13.0782C44.8594 12.8386 45.2656 12.6589 45.75 12.5391C46.2396 12.4141 46.7995 12.3516 47.4297 12.3516H48.8203ZM54.6562 5.50006V17.5001H52.5859V5.50006H54.6562Z" fill="#646464" />
                    </svg>
                    <p>{calorias}</p>
                </div>
            </div>
            <div>
                <div className="d-flex">
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.75 13.3341H4.5C4.49992 13.1883 4.45732 13.0456 4.37739 12.9236C4.29746 12.8015 4.18369 12.7055 4.05 12.6471L3.75 13.3341ZM17.75 13.3341L17.45 12.6471C17.3163 12.7055 17.2025 12.8015 17.1226 12.9236C17.0427 13.0456 17.0001 13.1883 17 13.3341H17.75ZM14.5 5.75012C14.5 5.94903 14.579 6.1398 14.7197 6.28045C14.8603 6.4211 15.0511 6.50012 15.25 6.50012C15.4489 6.50012 15.6397 6.4211 15.7803 6.28045C15.921 6.1398 16 5.94903 16 5.75012H14.5ZM5.5 5.75012C5.5 5.94903 5.57902 6.1398 5.71967 6.28045C5.86032 6.4211 6.05109 6.50012 6.25 6.50012C6.44891 6.50012 6.63968 6.4211 6.78033 6.28045C6.92098 6.1398 7 5.94903 7 5.75012H5.5ZM5.75 3.00012C4.22501 3.00012 2.76247 3.60592 1.68414 4.68426C0.605802 5.76259 9.37152e-08 7.22513 9.37152e-08 8.75012H1.5C1.5 7.62295 1.94777 6.54195 2.7448 5.74492C3.54183 4.94789 4.62283 4.50012 5.75 4.50012V3.00012ZM15.75 4.50012C16.8772 4.50012 17.9582 4.94789 18.7552 5.74492C19.5522 6.54195 20 7.62295 20 8.75012H21.5C21.5 7.22513 20.8942 5.76259 19.8159 4.68426C18.7375 3.60592 17.275 3.00012 15.75 3.00012V4.50012ZM13.75 20.0001H7.75V21.5001H13.75V20.0001ZM7.75 20.0001C6.786 20.0001 6.138 19.9981 5.655 19.9331C5.194 19.8711 4.996 19.7641 4.866 19.6331L3.806 20.6951C4.261 21.1501 4.828 21.3351 5.456 21.4201C6.062 21.5021 6.828 21.5001 7.75 21.5001V20.0001ZM3 16.7501C3 17.6721 2.998 18.4381 3.08 19.0441C3.164 19.6721 3.35 20.2391 3.805 20.6941L4.866 19.6341C4.736 19.5041 4.629 19.3061 4.566 18.8441C4.502 18.3621 4.5 17.7141 4.5 16.7501H3ZM17 16.7501C17 17.7141 16.998 18.3621 16.933 18.8451C16.871 19.3061 16.764 19.5041 16.633 19.6341L17.695 20.6941C18.15 20.2391 18.335 19.6721 18.42 19.0441C18.502 18.4381 18.5 17.6721 18.5 16.7501H17ZM13.75 21.5001C14.672 21.5001 15.438 21.5021 16.044 21.4201C16.672 21.3361 17.24 21.1501 17.695 20.6941L16.634 19.6341C16.504 19.7641 16.306 19.8711 15.844 19.9341C15.362 19.9981 14.714 20.0001 13.75 20.0001V21.5001ZM5.75 4.50012C5.96333 4.50012 6.17267 4.51546 6.378 4.54612L6.597 3.06212C6.31649 3.02147 6.03344 3.00076 5.75 3.00012V4.50012ZM10.75 0.000122265C9.6527 -0.000176127 8.58289 0.343353 7.69091 0.982433C6.79892 1.62151 6.1296 2.52402 5.777 3.56312L7.197 4.04512C7.4489 3.30277 7.92712 2.65802 8.56442 2.20152C9.20173 1.74502 9.96607 1.49973 10.75 1.50012V0.000122265ZM5.777 3.56312C5.59398 4.10676 5.50043 4.6765 5.5 5.25012H7C7 4.82712 7.07 4.42212 7.198 4.04512L5.777 3.56312ZM15.75 3.00012C15.4627 3.00012 15.1803 3.02079 14.903 3.06212L15.123 4.54612C15.3305 4.51436 15.5401 4.49898 15.75 4.50012V3.00012ZM10.75 1.50012C11.5338 1.49994 12.2979 1.74533 12.935 2.20181C13.5721 2.6583 14.0502 3.30293 14.302 4.04512L15.722 3.56312C15.3695 2.52418 14.7003 1.62179 13.8085 0.982724C12.9167 0.343658 11.8471 3.28837e-05 10.75 0.000122265V1.50012ZM14.302 4.04512C14.43 4.42212 14.5 4.82712 14.5 5.25012H16C16 4.66112 15.902 4.09412 15.722 3.56312L14.302 4.04512ZM4.5 16.7501V13.3341H3V16.7501H4.5ZM4.05 12.6471C3.2918 12.3162 2.64666 11.7712 2.1937 11.079C1.74074 10.3868 1.49965 9.57738 1.5 8.75012H9.37152e-08C-0.000201892 9.86912 0.326106 10.9639 0.938921 11.9001C1.55174 12.8364 2.42442 13.5735 3.45 14.0211L4.05 12.6471ZM17 13.3341V16.7501H18.5V13.3341H17ZM20 8.75012C20.0004 9.57738 19.7593 10.3868 19.3063 11.079C18.8533 11.7712 18.2082 12.3162 17.45 12.6471L18.05 14.0211C19.0756 13.5735 19.9483 12.8364 20.5611 11.9001C21.1739 10.9639 21.5002 9.86912 21.5 8.75012H20ZM14.5 5.25012V5.75012H16V5.25012H14.5ZM5.5 5.25012V5.75012H7V5.25012H5.5Z" fill="black" />
                        <path d="M7.75 16.7501H13.75" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <h3>Preparation mode</h3>
                </div>

                <ul>
                    {preparacion.length > 0 ? (
                        preparacion.map((step, index) => <li key={index}>{step}</li>) // Mapea cada paso en un <li>
                    ) : (
                        <li>Generando pasos para la preparación...</li>
                    )}
                </ul>
            </div>
        </div>
    );
};
