import React, { useContext, useEffect, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { Context } from "../store/appContext";

export const Navbar = () => {
	const navigate = useNavigate();
	const { store } = useContext(Context); // Accede a store para verificar el estado global del token
	const [isLogin, setIsLogin] = useState(true);
	const [token, setToken] = useState(localStorage.getItem("token"));

	// Funciones para manejar la navegación
	const goToHome = () => navigate("/");
	const goToLogin = () => navigate("/loginRegister");
	const goToMealPlan = () => navigate("/mealplan");

	// Redirigir al perfil si está logueado
    const goToProfile = () => {
        if (token) {
            // Si hay un token válido, redirige al perfil
            navigate("/profile");
        } else {
            // Si no hay token, redirige a login
            navigate("/loginRegister");
        }
    };

	const handleLogout = () => {
        localStorage.removeItem("token");
        setToken(""); // Limpia el estado local
        navigate("/");
    };

	useEffect(() => {
        // Escucha cambios en el token del almacenamiento local
        const storedToken = localStorage.getItem("token");
        setToken(storedToken);
    }, [store.token]); // Se asegura de actualizar el token global

	return (
		<nav className="navbar navbar-expand-lg bg-body-tertiary">
			<div className="container-fluid">
				<a className="navbar-brand" onClick={goToHome}>
					<svg width="131" height="36" viewBox="0 0 131 36" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M3.78 28V2.8H6.732L18.036 21.844H16.452L27.612 2.8H30.564L30.6 28H27.144L27.108 8.236H27.936L18 24.94H16.344L6.336 8.236H7.236V28H3.78ZM46.1548 28.216C44.1148 28.216 42.3148 27.796 40.7548 26.956C39.2188 26.116 38.0188 24.964 37.1548 23.5C36.3148 22.036 35.8948 20.356 35.8948 18.46C35.8948 16.564 36.3028 14.884 37.1188 13.42C37.9588 11.956 39.0988 10.816 40.5388 10C42.0028 9.16 43.6468 8.74 45.4708 8.74C47.3188 8.74 48.9508 9.148 50.3668 9.964C51.7828 10.78 52.8868 11.932 53.6788 13.42C54.4948 14.884 54.9028 16.6 54.9028 18.568C54.9028 18.712 54.8908 18.88 54.8668 19.072C54.8668 19.264 54.8548 19.444 54.8308 19.612H38.5948V17.128H53.0308L51.6268 17.992C51.6508 16.768 51.3988 15.676 50.8708 14.716C50.3428 13.756 49.6108 13.012 48.6748 12.484C47.7628 11.932 46.6948 11.656 45.4708 11.656C44.2708 11.656 43.2028 11.932 42.2668 12.484C41.3308 13.012 40.5988 13.768 40.0708 14.752C39.5428 15.712 39.2788 16.816 39.2788 18.064V18.64C39.2788 19.912 39.5668 21.052 40.1428 22.06C40.7428 23.044 41.5708 23.812 42.6268 24.364C43.6828 24.916 44.8948 25.192 46.2628 25.192C47.3908 25.192 48.4108 25 49.3228 24.616C50.2588 24.232 51.0748 23.656 51.7708 22.888L53.6788 25.12C52.8148 26.128 51.7348 26.896 50.4388 27.424C49.1668 27.952 47.7388 28.216 46.1548 28.216ZM71.0184 28V23.968L70.8384 23.212V16.336C70.8384 14.872 70.4064 13.744 69.5424 12.952C68.7024 12.136 67.4304 11.728 65.7264 11.728C64.5984 11.728 63.4944 11.92 62.4144 12.304C61.3344 12.664 60.4224 13.156 59.6784 13.78L58.2384 11.188C59.2224 10.396 60.3984 9.796 61.7664 9.388C63.1584 8.956 64.6104 8.74 66.1224 8.74C68.7384 8.74 70.7544 9.376 72.1704 10.648C73.5864 11.92 74.2944 13.864 74.2944 16.48V28H71.0184ZM64.7544 28.216C63.3384 28.216 62.0904 27.976 61.0104 27.496C59.9544 27.016 59.1384 26.356 58.5624 25.516C57.9864 24.652 57.6984 23.68 57.6984 22.6C57.6984 21.568 57.9384 20.632 58.4184 19.792C58.9224 18.952 59.7264 18.28 60.8304 17.776C61.9584 17.272 63.4704 17.02 65.3664 17.02H71.4144V19.504H65.5104C63.7824 19.504 62.6184 19.792 62.0184 20.368C61.4184 20.944 61.1184 21.64 61.1184 22.456C61.1184 23.392 61.4904 24.148 62.2344 24.724C62.9784 25.276 64.0104 25.552 65.3304 25.552C66.6264 25.552 67.7544 25.264 68.7144 24.688C69.6984 24.112 70.4064 23.272 70.8384 22.168L71.5224 24.544C71.0664 25.672 70.2624 26.572 69.1104 27.244C67.9584 27.892 66.5064 28.216 64.7544 28.216ZM80.6901 28V1.288H84.1461V28H80.6901ZM90.7448 28V8.92H94.2008V28H90.7448ZM92.4728 5.248C91.8008 5.248 91.2368 5.032 90.7808 4.6C90.3488 4.168 90.1328 3.64 90.1328 3.016C90.1328 2.368 90.3488 1.828 90.7808 1.396C91.2368 0.963999 91.8008 0.747999 92.4728 0.747999C93.1448 0.747999 93.6968 0.963999 94.1288 1.396C94.5848 1.804 94.8128 2.32 94.8128 2.944C94.8128 3.592 94.5968 4.144 94.1648 4.6C93.7328 5.032 93.1688 5.248 92.4728 5.248ZM101.303 28V7.228C101.303 5.356 101.843 3.868 102.923 2.764C104.027 1.636 105.587 1.072 107.603 1.072C108.347 1.072 109.055 1.168 109.727 1.36C110.423 1.528 111.011 1.804 111.491 2.188L110.447 4.816C110.087 4.528 109.679 4.312 109.223 4.168C108.767 4 108.287 3.916 107.783 3.916C106.775 3.916 106.007 4.204 105.479 4.78C104.951 5.332 104.687 6.16 104.687 7.264V9.82L104.759 11.404V28H101.303ZM98.0634 11.764V8.92H110.231V11.764H98.0634ZM114.67 35.2C113.758 35.2 112.87 35.044 112.006 34.732C111.142 34.444 110.398 34.012 109.774 33.436L111.25 30.844C111.73 31.3 112.258 31.648 112.834 31.888C113.41 32.128 114.022 32.248 114.67 32.248C115.51 32.248 116.206 32.032 116.758 31.6C117.31 31.168 117.826 30.4 118.306 29.296L119.494 26.668L119.854 26.236L127.342 8.92H130.726L121.474 29.908C120.922 31.252 120.298 32.308 119.602 33.076C118.93 33.844 118.186 34.384 117.37 34.696C116.554 35.032 115.654 35.2 114.67 35.2ZM119.206 28.612L110.494 8.92H114.094L121.51 25.912L119.206 28.612Z" fill="#8A42FB"/>
					</svg>
				</a>
				<button className="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
					<span className="navbar-toggler-icon"></span>
				</button>
				<div className="collapse navbar-collapse" id="navbarSupportedContent">
					<ul className="navbar-nav ms-auto mb-2 mb-lg-0">
						<li className="nav-item">
                            <a class="nav-link" aria-current="page" href="#" onClick={goToHome}>Home</a>
						</li>
						{token ? (
                            <>
                                <li className="nav-item">
                                    <a class="nav-link" aria-current="page" href="#" onClick={goToMealPlan}>Mealplan</a>
                                </li>
                                <li className="nav-item">
                                    <a class="nav-link" aria-current="page" href="#" onClick={goToProfile}>Profile</a>
                                </li>
                                <li className="nav-item">
                                    <button className="btn btn-outline-dark button-custon" onClick={handleLogout}>
                                        Logout
                                        <svg width="18" height="22" viewBox="0 0 18 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M9 0.25C7.74022 0.25 6.53204 0.750445 5.64124 1.64124C4.75044 2.53204 4.24999 3.74022 4.24999 5C4.24999 6.25978 4.75044 7.46796 5.64124 8.35876C6.53204 9.24955 7.74022 9.75 9 9.75C10.2598 9.75 11.468 9.24955 12.3588 8.35876C13.2495 7.46796 13.75 6.25978 13.75 5C13.75 3.74022 13.2495 2.53204 12.3588 1.64124C11.468 0.750445 10.2598 0.25 9 0.25ZM5.74999 5C5.74999 4.13805 6.0924 3.3114 6.7019 2.7019C7.31139 2.09241 8.13804 1.75 9 1.75C9.86195 1.75 10.6886 2.09241 11.2981 2.7019C11.9076 3.3114 12.25 4.13805 12.25 5C12.25 5.86195 11.9076 6.6886 11.2981 7.2981C10.6886 7.90759 9.86195 8.25 9 8.25C8.13804 8.25 7.31139 7.90759 6.7019 7.2981C6.0924 6.6886 5.74999 5.86195 5.74999 5ZM9 11.25C6.687 11.25 4.55499 11.776 2.97599 12.664C1.41999 13.54 0.249995 14.866 0.249995 16.5V16.602C0.248995 17.764 0.247995 19.222 1.52699 20.264C2.15599 20.776 3.03699 21.141 4.22699 21.381C5.41899 21.623 6.974 21.75 9 21.75C11.026 21.75 12.58 21.623 13.774 21.381C14.964 21.141 15.844 20.776 16.474 20.264C17.753 19.222 17.751 17.764 17.75 16.602V16.5C17.75 14.866 16.58 13.54 15.025 12.664C13.445 11.776 11.314 11.25 9 11.25ZM1.74999 16.5C1.74999 15.649 2.37199 14.725 3.71099 13.972C5.02699 13.232 6.895 12.75 9.001 12.75C11.105 12.75 12.973 13.232 14.289 13.972C15.629 14.725 16.25 15.649 16.25 16.5C16.25 17.808 16.21 18.544 15.526 19.1C15.156 19.402 14.536 19.697 13.476 19.911C12.419 20.125 10.974 20.25 9 20.25C7.026 20.25 5.58 20.125 4.52399 19.911C3.46399 19.697 2.84399 19.402 2.47399 19.101C1.78999 18.544 1.74999 17.808 1.74999 16.5Z" fill="#8A42FB"/>
                                        </svg>
                                    </button>
                                </li>
                            </>
                        ) : (
                            <li className="nav-item">
                                <button className="btn btn-outline-dark " onClick={goToLogin}>
                                    Login
                                </button>
                            </li>
                        )}
					</ul>
				</div>
			</div>
		</nav>
	);
};
